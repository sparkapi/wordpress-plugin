!function(t){var e=function(t){return{title:"General Search",body:[{type:"listbox",name:"style",label:"Style",values:[{text:"Clear",value:"clear"},{text:"White",value:"white"},{text:"Colour 1",value:"colour1"},{text:"Colour 2",value:"colour2"},{text:"Colour 3",value:"colour3"}]}],onsubmit:function(e){t.insertContent('[container style="'+e.data.style+'"]<br /><br />[/container]')}}},o=function(e){var o="Saved Searches",n=[],a=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!a){var i=wp.shortcode.next("flexmls_idxlinks",a,0);if(!0==!!i)try{var l=i.shortcode.attrs.named;l.hasOwnProperty("title")&&(o=l.title),l.hasOwnProperty("idx_link")&&(n=l.idx_link.split(","))}catch(t){console.log("Error"),console.log(t)}}return{title:"IDX Links",body:[{type:"textbox",name:"title",label:"Title",size:42,value:o},{type:"container",name:"idx_link",label:"IDX Link(s)",onPostRender:function(){var e=this.getEl(),o=e.firstChild,a=(t(o),this);t.post(ajaxurl,{action:"tinymce_get_idx_links"},function(t){if(t.length){for(var o=0;o<a.items().length;o++)a.items()[o].hide();for(var o=0;o<t.length;o++){var i={checked:-1!==n.indexOf(t[o].value),type:"checkbox",text:t[o].text,name:t[o].value};a.append(i)}e.style.overflowY="scroll",a.reflow()}},"json")},items:[{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0}]}],onsubmit:function(t){var o={},n=[];for(key in t.data)switch(!0){case"title"===key:o.title=t.data[key];break;default:!0===t.data[key]&&n.push(key)}o.idx_link=n.join(",");var a=wp.shortcode.string({tag:"flexmls_idxlinks",attrs:o,type:"single"});e.insertContent(a)}}},n=function(t){var e="Contact Me",o="",n="Thank you for your request",a="Submit",i=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!i){var l=wp.shortcode.next("flexmls_leadgen",i,0);if(!0==!!l)try{var r=l.shortcode.attrs.named;r.hasOwnProperty("title")&&(e=r.title),r.hasOwnProperty("blurb")&&(o=r.blurb),r.hasOwnProperty("success")&&(n=r.success),r.hasOwnProperty("buttontext")&&(a=r.buttontext)}catch(t){console.log("Error"),console.log(t)}}return{title:"Lead Generation",body:[{type:"textbox",name:"title",label:"Title",size:42,value:e},{type:"textbox",name:"blurb",label:"Description",multiline:!0,tooltip:"Optional: this text appears below the title",value:o},{type:"textbox",name:"success",label:"Success Message",multiline:!0,tooltip:"Appears after the message is sent successfully",value:n},{type:"textbox",name:"buttontext",label:"Button Text",tooltip:"Customize the text of the submit button",value:a}],onsubmit:function(e){var o={};o.title=JSON.stringify(e.data.title).slice(1,-1),o.blurb=JSON.stringify(e.data.blurb).slice(1,-1),o.success=JSON.stringify(e.data.success).slice(1,-1),o.buttontext=JSON.stringify(e.data.buttontext).slice(1,-1);var n=wp.shortcode.string({tag:"flexmls_leadgen",attrs:o,type:"single"});t.insertContent(n)}}},a=function(t){return{title:"1-Click Location Search",body:[{type:"listbox",name:"style",label:"Style",values:[{text:"Clear",value:"clear"},{text:"White",value:"white"},{text:"Colour 1",value:"colour1"},{text:"Colour 2",value:"colour2"},{text:"Colour 3",value:"colour3"}]}],onsubmit:function(e){t.insertContent('[container style="'+e.data.style+'"]<br /><br />[/container]')}}},i=function(t){return{title:"Market Statistics",body:[{type:"listbox",name:"style",label:"Style",values:[{text:"Clear",value:"clear"},{text:"White",value:"white"},{text:"Colour 1",value:"colour1"},{text:"Colour 2",value:"colour2"},{text:"Colour 3",value:"colour3"}]}],onsubmit:function(e){t.insertContent('[container style="'+e.data.style+'"]<br /><br />[/container]')}}},l=function(t){var e,o,n=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!n){var a=wp.shortcode.next("flexmls_portal",n,0);if(!0==!!a)try{var i=a.shortcode.attrs.named;i.hasOwnProperty("saved_searches")&&(e=parseInt(i.saved_searches)),i.hasOwnProperty("listing_carts")&&(o=parseInt(i.listing_carts))}catch(t){console.log("Error"),console.log(t)}}return{title:"Portal Widget",body:[{border:"0 0 0 0",margin:"0 0 0 0",multiline:!0,padding:"0 0 0 0",type:"infobox",text:"Do you want to display your visitor's Saved Searches on this widget?"},{checked:1===e,name:"saved_searches",type:"checkbox",text:"Yes, include Saved Searches"},{border:"0 0 0 0",margin:"0 0 0 0",multiline:!0,padding:"0 0 0 0",type:"infobox",text:"Do you want to display your visitor's Listing Carts on this widget?"},{checked:1===o,name:"listing_carts",type:"checkbox",text:"Yes, include Listing Carts"}],onsubmit:function(e){var o={};!0===e.data.saved_searches&&(o.saved_searches=1),!0===e.data.listing_carts&&(o.listing_carts=1);var n=wp.shortcode.string({tag:"flexmls_portal",attrs:o,type:"single"});t.insertContent(n)}}},r=function(t){return{title:"IDX Slideshow",body:[{type:"listbox",name:"style",label:"Style",values:[{text:"Clear",value:"clear"},{text:"White",value:"white"},{text:"Colour 1",value:"colour1"},{text:"Colour 2",value:"colour2"},{text:"Colour 3",value:"colour3"}]}],onsubmit:function(e){t.insertContent('[container style="'+e.data.style+'"]<br /><br />[/container]')}}};tinymce.PluginManager.add("flexmlsidx",function(t,s){t.addButton("flexmlsidx_shortcodes",{type:"menubutton",tooltip:"Add a Flexmls widget",title:"Add Flexmls Widget",image:flexmls.pluginurl+"/dist/assets/tinymce_flexmls_pin.png",menu:[{text:"1-Click Location Search",onclick:function(){t.windowManager.open(a(t))}},{text:"General Search",onclick:function(){t.windowManager.open(e(t))}},{text:"IDX Links",onclick:function(){t.windowManager.open(o(t))}},{text:"IDX Slideshow",onclick:function(){t.windowManager.open(r(t))}},{text:"Lead Generation",onclick:function(){t.windowManager.open(n(t))}},{text:"Market Statistics",onclick:function(){t.windowManager.open(i(t))}},{text:"Portal Widget",onclick:function(){t.windowManager.open(l(t))}}]})})}(jQuery);
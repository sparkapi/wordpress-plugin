var flexmls=void 0===flexmls?{}:flexmls;!function(t){flexmls.locationSelector=function(e){var a={c:"Y",command_line_mode:"true",cmd:"srv+api/search/getLocations.json",i:"City,StateOrProvince,StreetAddress,PostalCode,CountyOrParish,SubdivisionName,MLSAreaMajor,MLSAreaMinor,MapOverlay,ListingId,SchoolDistrict",l:18,ma:"x'"+flexmls.ma_tech_id+"'",p:"A",std:"Y",tech_id:"x'"+flexmls.tech_id+"'"};t(e).length&&(t(e).each(function(){!0==!!t(this).data("select2")&&t(this).select2("destroy")}),t(e).select2({width:"100%",ajax:{cache:!1,crossDomain:!0,dataType:"jsonp",delay:250,data:function(t){return a.q=t.term,a},error:function(t,e,a){console.log(t,e,a)},processResults:function(e,a){var o=[];return!0==!!e.results.length&&t.each(e.results,function(t,e){o.push({id:e.display_val+"***"+e.name,text:e.display_val+" ("+e.name.split(/(?=[A-Z])/).join(" ")+")"})}),!0==!!e.overlays.length&&t.each(e.overlays,function(t,e){o.push({id:e.display_val+"***"+e.name,text:e.display_val+" ("+e.name.split(/(?=[A-Z])/).join(" ")+")"})}),{results:o}},url:"https://www.flexmls.com/cgi-bin/mainmenu.cgi"},minimumInputLength:3}))},t(document).ready(function(){flexmls.locationSelector(".flexmls-locations-selector")}),t(document).on("widget-added",function(t,e){flexmls.locationSelector(".flexmls-locations-selector")}),t(document).on("widget-updated",function(t,e){flexmls.locationSelector(".flexmls-locations-selector")})}(jQuery);var flexmls=void 0===flexmls?{}:flexmls;!function(t){flexmls.ShortcodeGenerator=function(t){this.editor=t,this.defaultValues={}},flexmls.ShortcodeGenerator.prototype.userValues=function(){var t={},e=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!e){var a=wp.shortcode.next(this.shortCodeId,e,0);if(!0==!!a)try{t=a.shortcode.attrs.named}catch(t){console.log("Error",t)}}return t},flexmls.ShortcodeGenerator.prototype.getInitialValues=function(){return t.extend({},this.defaultValues,this.userValues())},flexmls.ShortcodeGenerator.prototype.onsubmit=function(t){var e=wp.shortcode.string({tag:this.shortCodeId,attrs:t.data,type:"single"});this.editor.insertContent(e)},flexmls.ShortcodeGenerator.prototype.addPropertyTypeValues=function(){var e=this;t.post(ajaxurl,{action:"tinymce_get_property_types"},function(t){if(t.length){for(var a=[],o=0;o<t.length;o++){var n={text:t[o].text,value:t[o].value};a.push(n)}var i={name:"property_type",type:"listbox",values:a,value:e.getInitialValues().property_type};e.propertyTypeInput.append(i),e.propertyTypeInput.items()[0].remove(),e.propertyTypeInput.reflow()}},"json")}}(jQuery),function(t){flexmls.LocationSearch=function(t){flexmls.ShortcodeGenerator.call(this,t)},flexmls.LocationSearch.prototype=Object.create(t.extend({},flexmls.ShortcodeGenerator.prototype,{constructor:flexmls.LocationSearch,editorOptions:function(){return{title:"1-Click Location Search",body:[{type:"textbox",name:"title",label:"Title",size:42,value:"1-Click Searches"},{items:[{disabled:!0,name:"idxlinksplaceholder",type:"listbox",values:[{text:"Loading Saved Searches",value:""}]}],label:"Saved Search",minWidth:42,name:"idx_link",onPostRender:this.idxLinksOnPostRender,type:"container"},{items:[{disabled:!0,name:"propertytypesplaceholder",type:"listbox",values:[{text:"Loading Property Types",value:""}]}],label:"Property Type",minWidth:42,name:"property_type",onPostRender:this.addPropertyTypeValues,type:"container"},{onKeyUp:function(t){console.log(this),console.log(t.target.value)},label:"Select Location(s)",name:"idx_area",size:42,text:"Search",type:"textbox"},{hidden:!1,label:" ",name:"idx_area_results",type:"selectbox"},{items:[],label:"Select Location(s)",type:"container"}],onsubmit:this.onsubmit.bind(this)}},idxLinksOnPostRender:function(){var e=this.getEl(),a=e.firstChild,o=(t(a),this);t.post(ajaxurl,{action:"tinymce_get_idx_links"},function(t){if(t.length){for(var e=[],a=0;a<t.length;a++){var n={text:t[a].text,value:t[a].value};e.push(n)}var i={name:"idxlinks",type:"listbox",values:e};o.append(i),o.items()[0].remove(),o.reflow()}},"json")}}))}(jQuery),function(t){flexmls.MarketStats=function(t){flexmls.ShortcodeGenerator.call(this,t),this.shortCodeId="flexmls_market_stats",this.modalTitle="Market Statistics",this.defaultValues={title:"Market Statistics",stat_type:"absorption",chart_type:"line",property_type:"A",time_period:12},this.statOptions},flexmls.MarketStats.prototype=Object.create(t.extend({},flexmls.ShortcodeGenerator.prototype,{constructor:flexmls.MarketStats,editorOptions:function(){return{title:this.modalTitle,body:this.body(),onsubmit:this.onsubmit.bind(this)}},body:function(){var e=this.getInitialValues(),a=this;return this.chartDataInput=tinymce.ui.Factory.create({type:"container",name:"chart_data",label:"What data would you like to display?",onPostRender:this.getChartDataValues.bind(this),minHeight:80,style:"overflow-y: scroll; overflow-x: hidden;"}),this.statTypeInput=tinymce.ui.Factory.create({type:"listbox",name:"stat_type",label:"Type of Statistics",value:e.stat_type,values:[{value:"absorption",text:"Absorption Rate"},{value:"inventory",text:"Inventory"},{value:"price",text:"Price"},{value:"ratio",text:"Sale to List Price Ratios"},{value:"dom",text:"Days On Market"},{value:"volume",text:"Volume"}],onselect:function(t){a.updateChartDataValues()}}),this.locationInput=tinymce.ui.Factory.create({type:"selectbox",name:"location_field",value:e.location_field,classes:"flexmls-locations-selector",onPostRender:function(){if(flexmls.locationSelector(".mce-flexmls-locations-selector"),void 0!==e.location_field){var a=e.location_field.split("***"),o=e.location_field,n=a[0]+" ("+a[1]+")",i=new Option(n,o,!0,!0);t(".mce-flexmls-locations-selector").append(i)}}}),this.propertyTypeInput=tinymce.ui.Factory.create({items:[{disabled:!0,type:"listbox",values:[{text:"Loading Property Types",value:""}]}],label:"Property Type",minWidth:42,name:"property_type",onPostRender:this.addPropertyTypeValues.bind(this),type:"container"}),[{type:"textbox",name:"title",label:"Title",size:42,value:e.title},this.statTypeInput,this.chartDataInput,{type:"listbox",name:"chart_type",label:"Chart Type",value:e.chart_type,values:[{value:"line",text:"Line Chart"},{value:"bar",text:"Bar Chart"}]},this.propertyTypeInput,{type:"listbox",name:"time_period",label:"Time Period",value:e.time_period,values:[{value:"1",text:"1 Month"},{value:"2",text:"2 Months"},{value:"3",text:"3 Months"},{value:"4",text:"4 Months"},{value:"5",text:"5 Months"},{value:"6",text:"6 Months"},{value:"7",text:"7 Months"},{value:"8",text:"8 Months"},{value:"9",text:"9 Months"},{value:"10",text:"10 Months"},{value:"11",text:"11 Months"},{value:"12",text:"12 Months"}]},{type:"container",label:"Select Location",items:[this.locationInput]}]},getChartDataValues:function(e){var a=this;void 0===this.statOptions?t.post(ajaxurl,{action:"tinymce_get_stat_options"},function(t){a.statOptions=t,a.updateChartDataValues()},"json"):a.updateChartDataValues()},updateChartDataValues:function(){var e=this.statTypeInput.value(),a=this.statOptions[e],o=[],n=[];void 0!==this.userValues().chart_data&&(n=this.userValues().chart_data.split(",")),Object.keys(a).forEach(function(t){var e=a[t],i="chart_data_"+t,l=n.indexOf(t)>=0;o.push({type:"checkbox",name:i,text:e,checked:l})}),t(this.chartDataInput.getEl()).find(".mce-container-body").html(""),this.chartDataInput.append(o).reflow()},onsubmit:function(e){var a=e.data,o=[],n=Object.keys(this.statOptions[a.stat_type]);Object.keys(a).forEach(function(t){if(0===t.indexOf("chart_data_")){var e=t.replace("chart_data_","");!0===a[t]&&n.indexOf(e)>=0&&o.push(e),delete a[t]}}),o.length>0&&(a.chart_data=o.join(","));var i=t(this.locationInput.getEl()).val();null!==i?a.location_field=i:delete a.location_field;var l=wp.shortcode.string({tag:this.shortCodeId,attrs:a,type:"single"});this.editor.insertContent(l)}}))}(jQuery),function(t){var e=function(t){return{title:"General Search",body:[{type:"listbox",name:"style",label:"Style",values:[{text:"Clear",value:"clear"},{text:"White",value:"white"},{text:"Colour 1",value:"colour1"},{text:"Colour 2",value:"colour2"},{text:"Colour 3",value:"colour3"}]}],onsubmit:function(e){t.insertContent('[container style="'+e.data.style+'"]<br /><br />[/container]')}}},a=function(e){var a="Saved Searches",o=[],n=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!n){var i=wp.shortcode.next("flexmls_idxlinks",n,0);if(!0==!!i)try{var l=i.shortcode.attrs.named;l.hasOwnProperty("title")&&(a=l.title),l.hasOwnProperty("idx_link")&&(o=l.idx_link.split(","))}catch(t){console.log("Error"),console.log(t)}}return{title:"IDX Links",body:[{type:"textbox",name:"title",label:"Title",size:42,value:a},{type:"container",name:"idx_link",label:"IDX Link(s)",onPostRender:function(){var e=this.getEl(),a=e.firstChild,n=(t(a),this);t.post(ajaxurl,{action:"tinymce_get_idx_links"},function(t){if(t.length){for(var a=0;a<n.items().length;a++)n.items()[a].hide();for(var a=0;a<t.length;a++){var i={checked:-1!==o.indexOf(t[a].value),type:"checkbox",text:t[a].text,name:t[a].value};n.append(i)}e.style.overflowY="scroll",n.reflow()}},"json")},items:[{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0}]}],onsubmit:function(t){var a={},o=[];for(key in t.data)switch(!0){case"title"===key:a.title=t.data[key];break;default:!0===t.data[key]&&o.push(key)}a.idx_link=o.join(",");var n=wp.shortcode.string({tag:"flexmls_idxlinks",attrs:a,type:"single"});e.insertContent(n)}}},o=function(t){var e="Contact Me",a="",o="Thank you for your request",n="Submit",i=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!i){var l=wp.shortcode.next("flexmls_leadgen",i,0);if(!0==!!l)try{var s=l.shortcode.attrs.named;s.hasOwnProperty("title")&&(e=s.title),s.hasOwnProperty("blurb")&&(a=s.blurb),s.hasOwnProperty("success")&&(o=s.success),s.hasOwnProperty("buttontext")&&(n=s.buttontext)}catch(t){console.log("Error"),console.log(t)}}return{title:"Lead Generation",body:[{type:"textbox",name:"title",label:"Title",size:42,value:e},{type:"textbox",name:"blurb",label:"Description",multiline:!0,tooltip:"Optional: this text appears below the title",value:a},{type:"textbox",name:"success",label:"Success Message",multiline:!0,tooltip:"Appears after the message is sent successfully",value:o},{type:"textbox",name:"buttontext",label:"Button Text",tooltip:"Customize the text of the submit button",value:n}],onsubmit:function(e){var a={};a.title=JSON.stringify(e.data.title).slice(1,-1),a.blurb=JSON.stringify(e.data.blurb).slice(1,-1),a.success=JSON.stringify(e.data.success).slice(1,-1),a.buttontext=JSON.stringify(e.data.buttontext).slice(1,-1);var o=wp.shortcode.string({tag:"flexmls_leadgen",attrs:a,type:"single"});t.insertContent(o)}}},n=function(t){var e,a,o=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!o){var n=wp.shortcode.next("flexmls_portal",o,0);if(!0==!!n)try{var i=n.shortcode.attrs.named;i.hasOwnProperty("saved_searches")&&(e=parseInt(i.saved_searches)),i.hasOwnProperty("listing_carts")&&(a=parseInt(i.listing_carts))}catch(t){console.log("Error"),console.log(t)}}return{title:"Portal Widget",body:[{border:"0 0 0 0",margin:"0 0 0 0",multiline:!0,padding:"0 0 0 0",type:"infobox",text:"Do you want to display your visitor's Saved Searches on this widget?"},{checked:1===e,name:"saved_searches",type:"checkbox",text:"Yes, include Saved Searches"},{border:"0 0 0 0",margin:"0 0 0 0",multiline:!0,padding:"0 0 0 0",type:"infobox",text:"Do you want to display your visitor's Listing Carts on this widget?"},{checked:1===a,name:"listing_carts",type:"checkbox",text:"Yes, include Listing Carts"}],onsubmit:function(e){var a={};!0===e.data.saved_searches&&(a.saved_searches=1),!0===e.data.listing_carts&&(a.listing_carts=1);var o=wp.shortcode.string({tag:"flexmls_portal",attrs:a,type:"single"});t.insertContent(o)}}},i=function(t){return{title:"IDX Slideshow",body:[{type:"listbox",name:"style",label:"Style",values:[{text:"Clear",value:"clear"},{text:"White",value:"white"},{text:"Colour 1",value:"colour1"},{text:"Colour 2",value:"colour2"},{text:"Colour 3",value:"colour3"}]}],onsubmit:function(e){t.insertContent('[container style="'+e.data.style+'"]<br /><br />[/container]')}}};tinymce.PluginManager.add("flexmlsidx",function(t,l){t.addButton("flexmlsidx_shortcodes",{type:"menubutton",tooltip:"Add a Flexmls widget",title:"Add Flexmls Widget",image:flexmls.pluginurl+"/dist/assets/tinymce_flexmls_pin.png",menu:[{text:"1-Click Location Search",onclick:function(){var e=new flexmls.LocationSearch(t);t.windowManager.open(e.editorOptions())}},{text:"General Search",onclick:function(){t.windowManager.open(e(t))}},{text:"IDX Links",onclick:function(){t.windowManager.open(a(t))}},{text:"IDX Slideshow",onclick:function(){t.windowManager.open(i(t))}},{text:"Lead Generation",onclick:function(){t.windowManager.open(o(t))}},{text:"Market Statistics",onclick:function(){var e=new flexmls.MarketStats(t);t.windowManager.open(e.editorOptions())}},{text:"Portal Widget",onclick:function(){t.windowManager.open(n(t))}}]})})}(jQuery);
!function(e){var t=function(e){return{title:"General Search",body:[{type:"listbox",name:"style",label:"Style",values:[{text:"Clear",value:"clear"},{text:"White",value:"white"},{text:"Colour 1",value:"colour1"},{text:"Colour 2",value:"colour2"},{text:"Colour 3",value:"colour3"}]}],onsubmit:function(t){e.insertContent('[container style="'+t.data.style+'"]<br /><br />[/container]')}}},n=function(t){var n="Saved Searches",o=[],a=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!a){var i=wp.shortcode.next("flexmls_idxlinks",a,0);if(!0==!!i)try{var l=i.shortcode.attrs.named;l.hasOwnProperty("title")&&(n=l.title),l.hasOwnProperty("idx_link")&&(o=l.idx_link.split(","))}catch(e){console.log("Error"),console.log(e)}}return{title:"IDX Links",body:[{type:"textbox",name:"title",label:"Title",size:42,value:n},{type:"container",name:"idx_link",label:"IDX Link(s)",onPostRender:function(){var t=this.getEl(),n=t.firstChild,a=(e(n),this);e.post(ajaxurl,{action:"tinymce_get_idx_links"},function(e){if(e.length){for(var n=0;n<a.items().length;n++)a.items()[n].hide();for(var n=0;n<e.length;n++){var i={checked:-1!==o.indexOf(e[n].value),type:"checkbox",text:e[n].text,name:e[n].value};a.append(i)}t.style.overflowY="scroll",a.reflow()}},"json")},items:[{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0},{disabled:!0,type:"checkbox",text:"Loading",value:0}]}],onsubmit:function(e){var n={},o=[];for(key in e.data)switch(!0){case"title"===key:n.title=e.data[key];break;default:!0===e.data[key]&&o.push(key)}n.idx_link=o.join(",");var a=wp.shortcode.string({tag:"flexmls_idxlinks",attrs:n,type:"single"});t.insertContent(a)}}},o=function(e){var t="Contact Me",n="",o="Thank you for your request",a="Submit",i=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!i){var l=wp.shortcode.next("flexmls_leadgen",i,0);if(!0==!!l)try{var r=l.shortcode.attrs.named;r.hasOwnProperty("title")&&(t=r.title),r.hasOwnProperty("blurb")&&(n=r.blurb),r.hasOwnProperty("success")&&(o=r.success),r.hasOwnProperty("buttontext")&&(a=r.buttontext)}catch(e){console.log("Error"),console.log(e)}}return{title:"Lead Generation",body:[{type:"textbox",name:"title",label:"Title",size:42,value:t},{type:"textbox",name:"blurb",label:"Description",multiline:!0,tooltip:"Optional: this text appears below the title",value:n},{type:"textbox",name:"success",label:"Success Message",multiline:!0,tooltip:"Appears after the message is sent successfully",value:o},{type:"textbox",name:"buttontext",label:"Button Text",tooltip:"Customize the text of the submit button",value:a}],onsubmit:function(t){var n={};n.title=JSON.stringify(t.data.title).slice(1,-1),n.blurb=JSON.stringify(t.data.blurb).slice(1,-1),n.success=JSON.stringify(t.data.success).slice(1,-1),n.buttontext=JSON.stringify(t.data.buttontext).slice(1,-1);var o=wp.shortcode.string({tag:"flexmls_leadgen",attrs:n,type:"single"});e.insertContent(o)}}},a=function(t){return{title:"1-Click Location Search",body:[{type:"textbox",name:"title",label:"Title",size:42,value:"1-Click Searches"},{items:[{disabled:!0,name:"idxlinksplaceholder",type:"listbox",values:[{text:"Loading Saved Searches",value:""}]}],label:"Saved Search",minWidth:42,name:"idx_link",onPostRender:function(){var t=this.getEl(),n=t.firstChild,o=(e(n),this);e.post(ajaxurl,{action:"tinymce_get_idx_links"},function(e){if(e.length){for(var t=[],n=0;n<e.length;n++){var a={text:e[n].text,value:e[n].value};t.push(a)}var i={name:"idxlinks",type:"listbox",values:t};o.append(i),o.items()[0].remove(),o.reflow()}},"json")},type:"container"},{items:[{disabled:!0,name:"propertytypesplaceholder",type:"listbox",values:[{text:"Loading Property Types",value:""}]}],label:"Property Type",minWidth:42,name:"property_type",onPostRender:function(){var t=this.getEl(),n=t.firstChild,o=(e(n),this);e.post(ajaxurl,{action:"tinymce_get_property_types"},function(e){if(e.length){for(var t=[],n=0;n<e.length;n++){var a={text:e[n].text,value:e[n].value};t.push(a)}var i={name:"propertytypes",type:"listbox",values:t};o.append(i),o.items()[0].remove(),o.reflow()}},"json")},type:"container"},{onKeyUp:function(e){console.log(this),console.log(e.target.value)},label:"Select Location(s)",name:"idx_area",size:42,text:"Search",type:"textbox"},{hidden:!1,label:" ",name:"idx_area_results",type:"selectbox"},{items:[],label:"Select Location(s)",type:"container"}],onsubmit:function(e){t.insertContent('[container style="'+e.data.style+'"]<br /><br />[/container]')}}},i=function(e){return{title:"Market Statistics",body:[{type:"listbox",name:"style",label:"Style",values:[{text:"Clear",value:"clear"},{text:"White",value:"white"},{text:"Colour 1",value:"colour1"},{text:"Colour 2",value:"colour2"},{text:"Colour 3",value:"colour3"}]}],onsubmit:function(t){e.insertContent('[container style="'+t.data.style+'"]<br /><br />[/container]')}}},l=function(e){var t,n,o=tinyMCE.activeEditor.selection.getContent({format:"text"});if(!0==!!o){var a=wp.shortcode.next("flexmls_portal",o,0);if(!0==!!a)try{var i=a.shortcode.attrs.named;i.hasOwnProperty("saved_searches")&&(t=parseInt(i.saved_searches)),i.hasOwnProperty("listing_carts")&&(n=parseInt(i.listing_carts))}catch(e){console.log("Error"),console.log(e)}}return{title:"Portal Widget",body:[{border:"0 0 0 0",margin:"0 0 0 0",multiline:!0,padding:"0 0 0 0",type:"infobox",text:"Do you want to display your visitor's Saved Searches on this widget?"},{checked:1===t,name:"saved_searches",type:"checkbox",text:"Yes, include Saved Searches"},{border:"0 0 0 0",margin:"0 0 0 0",multiline:!0,padding:"0 0 0 0",type:"infobox",text:"Do you want to display your visitor's Listing Carts on this widget?"},{checked:1===n,name:"listing_carts",type:"checkbox",text:"Yes, include Listing Carts"}],onsubmit:function(t){var n={};!0===t.data.saved_searches&&(n.saved_searches=1),!0===t.data.listing_carts&&(n.listing_carts=1);var o=wp.shortcode.string({tag:"flexmls_portal",attrs:n,type:"single"});e.insertContent(o)}}},r=function(e){return{title:"IDX Slideshow",body:[{type:"listbox",name:"style",label:"Style",values:[{text:"Clear",value:"clear"},{text:"White",value:"white"},{text:"Colour 1",value:"colour1"},{text:"Colour 2",value:"colour2"},{text:"Colour 3",value:"colour3"}]}],onsubmit:function(t){e.insertContent('[container style="'+t.data.style+'"]<br /><br />[/container]')}}};tinymce.PluginManager.add("flexmlsidx",function(e,s){e.addButton("flexmlsidx_shortcodes",{type:"menubutton",tooltip:"Add a Flexmls widget",title:"Add Flexmls Widget",image:flexmls.pluginurl+"/dist/assets/tinymce_flexmls_pin.png",menu:[{text:"1-Click Location Search",onclick:function(){e.windowManager.open(a(e))}},{text:"General Search",onclick:function(){e.windowManager.open(t(e))}},{text:"IDX Links",onclick:function(){e.windowManager.open(n(e))}},{text:"IDX Slideshow",onclick:function(){e.windowManager.open(r(e))}},{text:"Lead Generation",onclick:function(){e.windowManager.open(o(e))}},{text:"Market Statistics",onclick:function(){e.windowManager.open(i(e))}},{text:"Portal Widget",onclick:function(){e.windowManager.open(l(e))}}]})})}(jQuery);